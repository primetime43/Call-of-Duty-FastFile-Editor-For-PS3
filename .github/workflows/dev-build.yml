name: Dev Build

on:
  push:
    branches:
      - dev
  workflow_dispatch:  # Allows manual trigger from GitHub UI

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    - name: Restore dependencies
      run: dotnet restore "Call of Duty FastFile Editor.sln"

    - name: Build and Publish Main Editor
      run: |
        dotnet publish "Call of Duty FastFile Editor/Call of Duty FastFile Editor.csproj" `
          -c Release `
          -r win-x64 `
          --self-contained false `
          -p:PublishSingleFile=true `
          -p:IncludeNativeLibrariesForSelfExtract=true `
          -o ./publish

    - name: Build and Publish FastFile Compiler GUI
      run: |
        dotnet publish "FastFileCompilerGUI/FastFileCompilerGUI.csproj" `
          -c Release `
          -r win-x64 `
          --self-contained false `
          -p:PublishSingleFile=true `
          -p:IncludeNativeLibrariesForSelfExtract=true `
          -o ./publish-compiler

    - name: Build and Publish FastFile Tool GUI
      run: |
        dotnet publish "FastFileToolGUI/FastFileToolGUI.csproj" `
          -c Release `
          -r win-x64 `
          --self-contained false `
          -p:PublishSingleFile=true `
          -p:IncludeNativeLibrariesForSelfExtract=true `
          -o ./publish-tool

    - name: Upload Main Editor
      uses: actions/upload-artifact@v4
      with:
        name: Call-of-Duty-FastFile-Editor-Dev
        path: ./publish/Call of Duty FastFile Editor.exe
        retention-days: 14

    - name: Upload FastFile Compiler GUI
      uses: actions/upload-artifact@v4
      with:
        name: FastFileCompilerGUI-Dev
        path: ./publish-compiler/FastFileCompilerGUI.exe
        retention-days: 14

    - name: Upload FastFile Tool GUI
      uses: actions/upload-artifact@v4
      with:
        name: FastFileToolGUI-Dev
        path: ./publish-tool/FastFileToolGUI.exe
        retention-days: 14

    - name: Upload All Tools Bundle
      uses: actions/upload-artifact@v4
      with:
        name: All-Tools-Dev-Bundle
        path: |
          ./publish/Call of Duty FastFile Editor.exe
          ./publish-compiler/FastFileCompilerGUI.exe
          ./publish-tool/FastFileToolGUI.exe
        retention-days: 14
